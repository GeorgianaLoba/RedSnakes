<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
    <script type="text/javascript" src="scripts.js"></script><!--Used for getUserType();-->
    <meta charset="UTF-8">
    <title>Conferences</title>
</head>
<body onload="getConferences(); showAddConferenceButton()">

<div class="center-container">
    <script>
        function getConferences() {
            let http = new XMLHttpRequest();
            http.onreadystatechange = function () {
                if (this.readyState === 4 && this.status === 200) {
                    let table = document.getElementsByTagName("table")[0];
                    let old_tbody = document.getElementsByTagName("tbody")[0];
                    let new_tbody = document.createElement('tbody');

                    let json = jsonParse(this.responseText);

                    for (let i = 0; i < json.length; i++) {
                        let conference = json[i];

                        let row = new_tbody.insertRow();
                        let cell = row.insertCell();
                        cell.appendChild(document.createTextNode(conference["title"]));
                        cell = row.insertCell();
                        cell.appendChild(document.createTextNode(conference["description"]));
                        cell = row.insertCell();
                        cell.appendChild(document.createTextNode(conference["deadline-signup"]));
                        cell = row.insertCell();
                        cell.appendChild(document.createTextNode(conference["price"]));

                        let userType = getUserType();

                        let button = document.createElement("a");
                        button.classList.add("button-link");
                        button.innerHTML = "Register";

                        switch (userType) {
                            case "listener":
                                button.setAttribute("href", "listener-register.html");
                                break;
                            case "speaker":
                                button.setAttribute("href", "speaker-register.html");
                                break;
                            case "chair":
                                button.setAttribute("href", "chair-register.html");
                                break;
                            default:
                                console.log("Invalid user type");
                        }

                        cell = row.insertCell();
                        cell.appendChild(button);
                    }
                    table.replaceChild(new_tbody, old_tbody);
                }
            };
            http.open("GET", "api/conference/getAll", true);
            http.send(null);
        }

        function showAddConferenceButton() {
            let userType = getUserType();

            if (userType === "chair") {
                let button = document.createElement("a");
                button.setAttribute("href", "add-conference.html"); //fixme
                button.classList.add("button-link");
                button.innerHTML = "Add conference";
                button.setAttribute("style", "margin-left: auto; margin-right: auto; margin-top: 25px");

                let container = document.getElementsByClassName("center-container")[0];
                container.appendChild(button);
            }
        }
    </script>
    <div class="table-container">
        <table>
            <thead>
            <tr>
                <th>Title</th>
                <th>Description</th>
                <th>Deadline</th>
                <th>Price</th>
                <th>Register</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <!--button style="margin-top: 30px" type="submit">Add conference</button-->
</div>

</body>
</html>